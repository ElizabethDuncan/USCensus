<!DOCTYPE html>
<html>
  <head>
    <link href="static/css/map.css" rel="stylesheet" media="screen">
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
    <style>
      html, body, #map-canvas {
        width: 100%;
        margin: 0px;
        padding: 0px
      }
    </style>
    <script>

    var map;
    var infoWindow;
    var shadeValue;
    //var currentValue = 0;

      function initialize() {

        var map_options = {
          center: new google.maps.LatLng({{ lat }}, {{ lng }}),
          zoom: {{ z }},
          mapTypeId: google.maps.MapTypeId.ROADMAP
        }
        var flightpath;

        map = new google.maps.Map(document.getElementById('map_canvas'), map_options);

        var flightPlanCoordinates = [];
        var MegaDict = {{data}}

        //TODO: REPLACE 3 WITH THE SIZE OF THE LISTOFVALUES
        for ( var key in MegaDict) {

          var value = MegaDict[key]
          var length = value.length
          coordinates = value[0]
          shadeValue = value[length-1]

          //map.currentValue = listofValues[j]

          for ( var i = 0, l = coordinates.length; i < l; i++) {
            flightPlanCoordinates.push( new google.maps.LatLng(coordinates[i][1], coordinates[i][0]))
          } 

          if (length == 4) {
          flightPath = new google.maps.Polygon({
            paths: flightPlanCoordinates,
            strokeColor: '#ffffff',
            strokeOpacity: 1.0,
            strokeWeight: 2,
            fillColor: '#ff0000',
            fillOpacity: shadeValue,
            blockID: key,
            blockValue: value[1],
            blockAcs: value[2]
          }); }

          else { 
          flightPath = new google.maps.Polygon({
            paths: flightPlanCoordinates,
            strokeColor: '#ffffff',
            strokeOpacity: 1.0,
            strokeWeight: 2,
            fillColor: '#ff0000',
            fillOpacity: shadeValue,
            blockID: key,
            blockValue: value[1]
          }); }

          flightPath.setMap(map);
          flightPlanCoordinates = [];

  
          google.maps.event.addListener(flightPath, 'click', showArrays);

          infoWindow = new google.maps.InfoWindow();



        }

      /** @this {google.maps.Polygon} */
      function showArrays(event) {
        console.log(event)

        // Since this polygon has only one path, we can call getPath()
        // to return the MVCArray of LatLngs.
        /*
        var vertices = this.getPath(); */
        var contentString = "<b>Block Details</b><br>" ; 

        contentString += '<br>' + "FIPS ID: "  + this.blockID + '<br>';

        contentString += "Number of people in the requested demographic: "  + this.blockValue + '<br>';

        if (length == 4) { 
        contentString += "Number of people with requested ACS traits: " + this.blockAcs + '<br>';
        }

        // Replace the info window's content and position.
        infoWindow.setContent(contentString);
        infoWindow.setPosition(event.latLng);

        infoWindow.open(map);
      }
      }
      google.maps.event.addDomListener(window, 'load', initialize);

    // var bounds = map.getBounds();
    // var ne = bounds.getNorthEast(); // LatLng of the north-east corner
    // var sw = bounds.getSouthWest(); // LatLng of the south-west corder
    // var nw = new google.maps.LatLng(ne.lat(), sw.lng());
    // var se = new google.maps.LatLng(sw.lat(), ne.lng())

    // console.log("EDGES")
    // console.log(ne)
    // console.log(sw)
    </script>
  </head>

    
    <div id="map_canvas"></div>
    


</html>